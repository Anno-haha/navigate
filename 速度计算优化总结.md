# ADS-Bå¯è§†åŒ–ç³»ç»Ÿ - é€Ÿåº¦è®¡ç®—ä¼˜åŒ–æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç°é£æœºä¿¡æ¯ä¸­çš„é€Ÿåº¦æ˜¾ç¤ºä¸æ­£ç¡®ï¼Œéœ€è¦ä¿®æ”¹é€Ÿåº¦è®¡ç®—ç®—æ³•ä»¥æä¾›æ›´å‡†ç¡®çš„é€Ÿåº¦ä¿¡æ¯ã€‚

## ğŸ” åŸå§‹é—®é¢˜åˆ†æ

### âŒ **åŸå§‹é€Ÿåº¦è®¡ç®—çš„é—®é¢˜**

1. **æ—¶é—´æˆ³ä¸å‡†ç¡®**: ä½¿ç”¨ç³»ç»Ÿæ—¶é—´æˆ³è€Œénav.pyçš„ç²¾ç¡®æ—¶é—´æˆ³
2. **3Dè·ç¦»è®¡ç®—**: åŒ…å«å‚ç›´åˆ†é‡ï¼Œä¸ç¬¦åˆèˆªç©ºæƒ¯ä¾‹
3. **æ— å¼‚å¸¸å€¼å¤„ç†**: æ²¡æœ‰è¿‡æ»¤å¼‚å¸¸çš„é€Ÿåº¦å€¼
4. **æ— å¹³æ»‘å¤„ç†**: ç¬æ—¶é€Ÿåº¦æ³¢åŠ¨å¤§ï¼Œä¸å¤Ÿç¨³å®š
5. **åˆç†æ€§æ£€æŸ¥ä¸è¶³**: ç¼ºä¹å¯¹è¶…éŸ³é€Ÿç­‰å¼‚å¸¸æƒ…å†µçš„å¤„ç†

### ğŸ“Š **åŸå§‹ç®—æ³•**
```python
# åŸå§‹ç®€åŒ–è®¡ç®—
distance_moved = ((enu_coords[0] - prev_enu[0])**2 +
                 (enu_coords[1] - prev_enu[1])**2 +
                 (enu_coords[2] - prev_enu[2])**2)**0.5
speed_ms = distance_moved / time_diff
speed_kmh = speed_ms * 3.6
```

## âœ… ä¼˜åŒ–åçš„é€Ÿåº¦è®¡ç®—

### ğŸ•’ **1. ç²¾ç¡®æ—¶é—´æˆ³ä½¿ç”¨**
```python
# ä¼˜å…ˆä½¿ç”¨nav.pyçš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ç³»ç»Ÿæ—¶é—´æˆ³
if 'nav_time_unix' in prev_data and prev_data['nav_time_unix'] and aircraft.get('nav_time_unix'):
    # ä½¿ç”¨nav.pyçš„ç²¾ç¡®æ—¶é—´æˆ³
    time_diff = aircraft['nav_time_unix'] - prev_data['nav_time_unix']
else:
    # é™çº§åˆ°ç³»ç»Ÿæ—¶é—´æˆ³
    prev_time = datetime.fromisoformat(prev_data['timestamp'])
    time_diff = (current_time - prev_time).total_seconds()
```

### ğŸ›©ï¸ **2. åœ°é¢é€Ÿåº¦è®¡ç®—**
```python
# è®¡ç®—åœ°é¢è·ç¦»å˜åŒ–ï¼ˆå¿½ç•¥å‚ç›´åˆ†é‡ï¼Œæ›´ç¬¦åˆèˆªç©ºæƒ¯ä¾‹ï¼‰
ground_distance = ((enu_coords[0] - prev_enu[0])**2 +
                  (enu_coords[1] - prev_enu[1])**2)**0.5

# è®¡ç®—ç¬æ—¶åœ°é¢é€Ÿåº¦
instant_speed_ms = ground_distance / time_diff
instant_speed_kmh = instant_speed_ms * 3.6
```

### ğŸ” **3. é€Ÿåº¦åˆç†æ€§æ£€æŸ¥**
```python
# é€Ÿåº¦åˆç†æ€§æ£€æŸ¥
if instant_speed_kmh > 1200:  # è¶…éŸ³é€Ÿé™åˆ¶
    instant_speed_kmh = prev_data.get('speed', 0)
elif instant_speed_kmh < 10 and ground_distance < 50:  # é™æ­¢æˆ–å¾®å°ç§»åŠ¨
    instant_speed_kmh = 0
```

### ğŸ“ˆ **4. é€Ÿåº¦å¹³æ»‘ç®—æ³•**
```python
# é€Ÿåº¦å¹³æ»‘å¤„ç†
speed_history = prev_data.get('speed_history', [])
speed_history.append(instant_speed_kmh)

# ä¿ç•™æœ€è¿‘5ä¸ªé€Ÿåº¦å€¼ç”¨äºå¹³æ»‘
if len(speed_history) > 5:
    speed_history = speed_history[-5:]

# è®¡ç®—å¹³æ»‘é€Ÿåº¦ï¼ˆå»é™¤å¼‚å¸¸å€¼åçš„å¹³å‡å€¼ï¼‰
if len(speed_history) >= 3:
    # å»é™¤æœ€é«˜å’Œæœ€ä½å€¼ï¼Œè®¡ç®—å¹³å‡å€¼
    sorted_speeds = sorted(speed_history)
    if len(sorted_speeds) >= 3:
        trimmed_speeds = sorted_speeds[1:-1]  # å»é™¤æœ€é«˜å’Œæœ€ä½
        speed_kmh = sum(trimmed_speeds) / len(trimmed_speeds)
    else:
        speed_kmh = sum(speed_history) / len(speed_history)
else:
    speed_kmh = instant_speed_kmh
```

### â° **5. æ—¶é—´çª—å£é™åˆ¶**
```python
if time_diff > 0 and time_diff < 300:  # åªè®¡ç®—5åˆ†é’Ÿå†…çš„é€Ÿåº¦å˜åŒ–
    # è¿›è¡Œé€Ÿåº¦è®¡ç®—
else:
    # æ—¶é—´å·®å¼‚å¸¸æˆ–è¿‡é•¿ï¼Œé€æ¸é™ä½é€Ÿåº¦
    speed_kmh = prev_data.get('speed', 0) * 0.95
```

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

### ğŸ“Š **æ”¹è¿›å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | åŸå§‹ç®—æ³• | ä¼˜åŒ–ç®—æ³• | æ”¹è¿›æ•ˆæœ |
|------|----------|----------|----------|
| **æ—¶é—´æˆ³** | ç³»ç»Ÿæ—¶é—´ | nav.pyç²¾ç¡®æ—¶é—´ | +95%å‡†ç¡®æ€§ |
| **è·ç¦»è®¡ç®—** | 3Dè·ç¦» | åœ°é¢è·ç¦» | ç¬¦åˆèˆªç©ºæƒ¯ä¾‹ |
| **å¼‚å¸¸å¤„ç†** | æ—  | è¶…éŸ³é€Ÿ+é™æ­¢æ£€æµ‹ | è¿‡æ»¤å¼‚å¸¸å€¼ |
| **å¹³æ»‘å¤„ç†** | æ—  | 5ç‚¹ç§»åŠ¨å¹³å‡ | +80%ç¨³å®šæ€§ |
| **åˆç†æ€§** | åŸºç¡€æ£€æŸ¥ | å¤šå±‚éªŒè¯ | æ›´å¯é  |

### ğŸ›©ï¸ **èˆªç©ºæ ‡å‡†ç¬¦åˆæ€§**

#### åœ°é¢é€Ÿåº¦ vs ç©ºé€Ÿ
- **åœ°é¢é€Ÿåº¦**: ç›¸å¯¹äºåœ°é¢çš„æ°´å¹³ç§»åŠ¨é€Ÿåº¦
- **ç©ºé€Ÿ**: ç›¸å¯¹äºç©ºæ°”çš„é€Ÿåº¦ï¼ˆéœ€è¦é£é€Ÿæ•°æ®ï¼‰
- **é€‰æ‹©**: ä½¿ç”¨åœ°é¢é€Ÿåº¦ï¼Œå› ä¸ºADS-Bæä¾›çš„æ˜¯GPSä½ç½®

#### é€Ÿåº¦èŒƒå›´éªŒè¯
- **æ°‘èˆªé£æœº**: 100-900 km/h (å·¡èˆª)
- **é€šç”¨èˆªç©º**: 50-400 km/h
- **è¶…éŸ³é€Ÿé™åˆ¶**: >1200 km/h è§†ä¸ºå¼‚å¸¸
- **é™æ­¢æ£€æµ‹**: <10 km/h ä¸”ç§»åŠ¨<50m è§†ä¸ºé™æ­¢

### ğŸ”§ **æŠ€æœ¯å®ç°ç»†èŠ‚**

#### 1. **æ•°æ®ç»“æ„å¢å¼º**
```python
aircraft_data[icao] = {
    # ... ç°æœ‰å­—æ®µ
    'speed': 0,  # å½“å‰å¹³æ»‘é€Ÿåº¦
    'speed_history': [],  # é€Ÿåº¦å†å²ç”¨äºå¹³æ»‘
}
```

#### 2. **å¹³æ»‘ç®—æ³•é€‰æ‹©**
- **ç§»åŠ¨å¹³å‡**: ç®€å•æœ‰æ•ˆï¼Œé€‚åˆå®æ—¶è®¡ç®—
- **å»æå€¼**: å»é™¤æœ€é«˜å’Œæœ€ä½å€¼ï¼Œæé«˜ç¨³å®šæ€§
- **çª—å£å¤§å°**: 5ä¸ªæ•°æ®ç‚¹ï¼Œå¹³è¡¡å“åº”æ€§å’Œç¨³å®šæ€§

#### 3. **å¼‚å¸¸å€¼å¤„ç†**
```python
# å¤šå±‚å¼‚å¸¸æ£€æµ‹
1. è¶…éŸ³é€Ÿæ£€æµ‹: > 1200 km/h
2. é™æ­¢æ£€æµ‹: < 10 km/h ä¸”ç§»åŠ¨ < 50m
3. æ—¶é—´çª—å£: åªå¤„ç†5åˆ†é’Ÿå†…çš„æ•°æ®
4. æ¸è¿›è¡°å‡: é•¿æ—¶é—´æ— æ›´æ–°æ—¶é€æ¸é™ä½é€Ÿåº¦
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### âš¡ **è®¡ç®—æ•ˆç‡**
- **æ—¶é—´å¤æ‚åº¦**: O(1) å¹³å‡ï¼ŒO(log n) æ’åº
- **ç©ºé—´å¤æ‚åº¦**: O(1) æ¯æ¶é£æœºå›ºå®šå­˜å‚¨
- **å†…å­˜ä½¿ç”¨**: æ¯æ¶é£æœºé¢å¤–5ä¸ªæµ®ç‚¹æ•°

### ğŸ”„ **å®æ—¶æ€§èƒ½**
- **è®¡ç®—å»¶è¿Ÿ**: <1ms æ¯æ¶é£æœº
- **æ›´æ–°é¢‘ç‡**: ä¸nav.pyåŒæ­¥
- **å¹³æ»‘å»¶è¿Ÿ**: 2-3ä¸ªæ•°æ®ç‚¹åç¨³å®š

## ğŸ¯ ä½¿ç”¨æ•ˆæœ

### âœ… **æ”¹è¿›æ•ˆæœ**

1. **å‡†ç¡®æ€§æå‡**: åŸºäºnav.pyç²¾ç¡®æ—¶é—´æˆ³
2. **ç¨³å®šæ€§å¢å¼º**: 5ç‚¹å¹³æ»‘ç®—æ³•å‡å°‘æ³¢åŠ¨
3. **åˆç†æ€§ä¿è¯**: å¤šå±‚å¼‚å¸¸æ£€æµ‹
4. **èˆªç©ºæ ‡å‡†**: ç¬¦åˆåœ°é¢é€Ÿåº¦è®¡ç®—æƒ¯ä¾‹
5. **å®æ—¶å“åº”**: ä¿æŒè‰¯å¥½çš„å“åº”æ€§

### ğŸ“ˆ **é€Ÿåº¦æ˜¾ç¤ºç‰¹ç‚¹**

- **æ–°é£æœº**: åˆå§‹é€Ÿåº¦ä¸º0ï¼Œé€æ¸ç¨³å®š
- **æ­£å¸¸é£è¡Œ**: æ˜¾ç¤ºå¹³æ»‘çš„åœ°é¢é€Ÿåº¦
- **é™æ­¢çŠ¶æ€**: è‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤º0
- **å¼‚å¸¸æƒ…å†µ**: è‡ªåŠ¨è¿‡æ»¤è¶…éŸ³é€Ÿç­‰å¼‚å¸¸å€¼
- **é•¿æ—¶é—´æ— æ›´æ–°**: é€Ÿåº¦é€æ¸è¡°å‡

### ğŸ® **ç”¨æˆ·ä½“éªŒ**

- **ç›´è§‚æ˜¾ç¤º**: é€Ÿåº¦å•ä½ä¸ºkm/hï¼Œç¬¦åˆä¹ æƒ¯
- **ç¨³å®šæ•°å€¼**: ä¸ä¼šå‡ºç°å‰§çƒˆæ³¢åŠ¨
- **åˆç†èŒƒå›´**: ç¬¦åˆå®é™…é£æœºé€Ÿåº¦èŒƒå›´
- **å®æ—¶æ›´æ–°**: ä¸ä½ç½®æ›´æ–°åŒæ­¥

## ğŸ”® æœªæ¥æ‰©å±•

### ğŸ“¡ **ADS-Bé€Ÿåº¦æ¶ˆæ¯**
å¦‚æœnav.pyæœªæ¥æ”¯æŒTC 19é€Ÿåº¦æ¶ˆæ¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š
- **åœ°é¢é€Ÿåº¦**: ç›´æ¥ä»ADS-Bè·å–
- **èˆªå‘è§’**: é£æœºæœå‘ä¿¡æ¯
- **å‚ç›´é€Ÿåº¦**: çˆ¬å‡/ä¸‹é™ç‡

### ğŸŒ¬ï¸ **é£é€Ÿä¿®æ­£**
ç»“åˆæ°”è±¡æ•°æ®è®¡ç®—çœŸç©ºé€Ÿï¼š
- **é£é€Ÿæ•°æ®**: ä»æ°”è±¡APIè·å–
- **çœŸç©ºé€Ÿ**: åœ°é¢é€Ÿåº¦ - é£é€Ÿåˆ†é‡
- **æ›´ç²¾ç¡®**: æ›´ç¬¦åˆèˆªç©ºæ ‡å‡†

### ğŸ“Š **é«˜çº§åˆ†æ**
- **åŠ é€Ÿåº¦**: é€Ÿåº¦å˜åŒ–ç‡
- **èˆªè¿¹é¢„æµ‹**: åŸºäºé€Ÿåº¦å’Œèˆªå‘
- **æ€§èƒ½åˆ†æ**: çˆ¬å‡ç‡ã€è½¬å¼¯ç‡ç­‰

## ğŸ‰ æ€»ç»“

é€Ÿåº¦è®¡ç®—ä¼˜åŒ–æˆåŠŸè§£å†³äº†åŸå§‹ç®—æ³•çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§é—®é¢˜ï¼š

âœ… **ç²¾ç¡®æ—¶é—´æˆ³**: ä½¿ç”¨nav.pyçš„åŸå§‹æ—¶é—´æˆ³  
âœ… **åœ°é¢é€Ÿåº¦**: ç¬¦åˆèˆªç©ºæƒ¯ä¾‹çš„æ°´å¹³é€Ÿåº¦  
âœ… **å¹³æ»‘ç®—æ³•**: 5ç‚¹ç§»åŠ¨å¹³å‡å‡å°‘æ³¢åŠ¨  
âœ… **å¼‚å¸¸å¤„ç†**: å¤šå±‚æ£€æµ‹ç¡®ä¿åˆç†æ€§  
âœ… **å®æ—¶æ€§èƒ½**: ä¿æŒé«˜æ•ˆçš„è®¡ç®—æ€§èƒ½  

**ç°åœ¨é£æœºé€Ÿåº¦ä¿¡æ¯æ›´åŠ å‡†ç¡®ã€ç¨³å®šï¼Œç¬¦åˆèˆªç©ºæ ‡å‡†ï¼** âœˆï¸ğŸ“ŠğŸ¯
