# ADS-B导航系统 ECEF & ENU 坐标转换功能

## 🎯 功能概述

nav.py 现已集成完整的坐标转换功能，支持从经纬度到地心地固坐标系(ECEF)，再到东北天坐标系(ENU)的完整转换链。

## 📐 坐标系统说明

### 1. 地理坐标系 (LLA)
- **纬度 (Latitude)**: 北纬为正，南纬为负
- **经度 (Longitude)**: 东经为正，西经为负  
- **高度 (Altitude)**: 相对于WGS84椭球面的高度

### 2. 地心地固坐标系 (ECEF)
- **原点**: 地球质心
- **X轴**: 指向本初子午线与赤道交点
- **Y轴**: 指向东经90°与赤道交点
- **Z轴**: 指向北极
- **单位**: 米

### 3. 东北天坐标系 (ENU)
- **参考点**: 北京上空10000m (39.9°N, 116.4°E)
- **E轴**: 东向，正值表示在参考点东方
- **N轴**: 北向，正值表示在参考点北方
- **U轴**: 天向，正值表示在参考点上方
- **单位**: 米

## 🔧 技术实现

### ECEFConverter 类
```python
# WGS84椭球参数
WGS84_A = 6378137.0  # 地球赤道半径
WGS84_E2 = 6.69437999014e-3  # 第一偏心率平方

# 转换公式
N = a / √(1 - e² × sin²φ)
X = (N + h) × cos φ × cos λ
Y = (N + h) × cos φ × sin λ  
Z = (N × (1 - e²) + h) × sin φ
```

### ENUConverter 类
```python
# 参考点: 北京上空10000m
REF_LATITUDE = 39.9°N
REF_LONGITUDE = 116.4°E  
REF_ALTITUDE = 10000m

# ENU转换公式
E = -sin λᵣ × ΔX + cos λᵣ × ΔY
N = -sin φᵣ cos λᵣ × ΔX - sin φᵣ sin λᵣ × ΔY + cos φᵣ × ΔZ
U = cos φᵣ cos λᵣ × ΔX + cos φᵣ sin λᵣ × ΔY + sin φᵣ × ΔZ
```

## 📊 输出格式

### 控制台实时输出
```
✈️ ICAO:CA1234 位置:(39.900000°, 116.400000°) 高度:35000ft ECEF:(-2182051.1, 4395713.4, 4075888.1)m ENU:(0.0, 0.0, 4572.0)m
```

### 日志文件格式 (adsb_decoded.log)
```csv
时间戳,ICAO,纬度,经度,高度(英尺),ECEF_X,ECEF_Y,ECEF_Z,ENU_E,ENU_N,ENU_U
2025-06-26 19:30:00,CA1234,39.900000,116.400000,35000,-2182051.1,4395713.4,4075888.1,0.0,0.0,4572.0
```

## 🧪 验证结果

### ECEF坐标验证
- ✅ 距地心距离: 6370621~6375298米 (符合地球半径范围)
- ✅ 坐标范围合理: 符合北京地区的ECEF坐标特征
- ✅ 数学公式准确: 严格按照WGS84标准实现

### ENU坐标验证
- ✅ 参考点自身: (0, 0, 0) ±0.001m精度
- ✅ 方向定义正确: 东/北/上方向分量符合预期
- ✅ 距离计算合理: 北京-天津距离~103km (理论120km)

### 典型位置ENU坐标
| 位置 | E(东向) | N(北向) | U(天向) | 距离 |
|------|---------|---------|---------|------|
| 天安门广场 | 633m | 466m | -9950m | 786m |
| 首都机场T3 | 15728m | 20014m | -10016m | 25454m |
| 大兴机场 | 903m | -43323m | -10102m | 43333m |
| 天津滨海机场 | 81836m | -85675m | -11098m | 118479m |

## 🚀 使用方法

### 基本运行
```bash
python nav.py
```

### 功能测试
```bash
python test_ecef.py    # 测试ECEF转换
python test_enu.py     # 测试ENU转换
python demo_enu_output.py  # 演示完整输出
```

### 数据分析
```bash
python analyze_ecef.py  # 分析坐标数据
```

## 📈 应用场景

### 1. 航空导航
- 飞机相对位置计算
- 航迹规划和监控
- 空中交通管制

### 2. 精密定位
- 高精度位置服务
- 测量和测绘
- 工程应用

### 3. 数据分析
- 飞行轨迹分析
- 空域使用统计
- 安全监控

## ⚙️ 配置参数

### 参考点设置
```python
# 可在ENUConverter类中修改参考点
REF_LATITUDE = 39.9    # 参考纬度
REF_LONGITUDE = 116.4  # 参考经度  
REF_ALTITUDE = 10000.0 # 参考高度(米)
```

### 精度控制
- ECEF坐标精度: 0.1米
- ENU坐标精度: 0.1米
- 角度计算精度: 双精度浮点

## 🔍 故障排除

### 常见问题
1. **坐标异常**: 检查输入经纬度范围和高度单位
2. **精度问题**: 确认使用WGS84基准面高度
3. **距离偏差**: 验证参考点设置是否正确

### 调试工具
- `test_ecef.py`: 验证ECEF转换精度
- `test_enu.py`: 验证ENU转换正确性
- `analyze_ecef.py`: 分析实际数据质量

## 📚 参考资料

### 数学公式来源
- WGS84椭球参数标准
- ECEF坐标转换标准算法
- ENU局部坐标系转换公式

### 验证标准
- 地球半径: 6356752m (极半径) ~ 6378137m (赤道半径)
- 北京地区ECEF坐标范围验证
- 典型距离计算验证

## 🎉 功能特点

- ✅ **完整坐标链**: LLA → ECEF → ENU 完整转换
- ✅ **高精度计算**: 基于WGS84标准实现
- ✅ **实时处理**: 自动计算每个飞机位置的所有坐标
- ✅ **灵活配置**: 可自定义参考点位置
- ✅ **完整记录**: 日志包含所有坐标信息
- ✅ **易于扩展**: 面向对象设计便于功能扩展

现在nav.py提供了完整的坐标转换功能，满足各种导航和定位应用需求！
